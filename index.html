<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Wish master</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <style>
        .darkTheme {
            color: white;
            background-color: #353535;
            height: 100vh;
        }

        .main-title {
            padding-top: 24px;
        }

        .grid {
            display: grid;
            grid-template-columns: auto auto;
            grid-column-gap: 16px;
        }

        .img {
            cursor: pointer;
            transition: 0.5s;
        }

        .img:hover {
            cursor: pointer;
            opacity: 0.5;
        }

    </style>

</head>
<body>

<div class="darkTheme">
    <div class="container">
        <div class="main-title text-align-center">
            <h2>Birthday Master</h2>
        </div>

        <div class="pictures grid">
            <img class="img" id="img1" width="100%" alt="" onclick="selectWish('first')">
            <img class="img" id="img2" width="100%" alt="" onclick="selectWish('second')">
        </div>

        <button id="startbtn" onclick="start()"> click</button>

        <div id="result"></div>
    </div>

</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

<script>


    let wishes =
        [
            {
                code: "ticket",
                description: "Ticket to any place",
            },
            {
                code: "parachute",
                description: "Parachute jump",
            },
            {
                code: "laptop",
                description: "New laptop",
            },
            {
                code: "microphone",
                description: "Professional microphone",
            },
            {
                code: "license",
                description: "Driving license"
            },
            {
                code: "studio",
                description: "Video studio toolkit",
            },
            {
                code: "vocal",
                description: "Vocal course",
            },
            {
                code: "makeup",
                description: "Make up course",
            },
            {
                code: "ikea",
                description: "15k in Ikea",
            },
            {
                code: "wine",
                description: "Toolkit for craft wine",
            }
        ]

    let storedWishes = []
    let imageSet = 1
    let pointer = 0
    let decision = null

    let finalResult = null

    let start = () => {
        document.getElementById("startbtn").style.display = "none"
        generateImages(wishes)
    }

    let checkImageExist = (image_url) => {
        let http = new XMLHttpRequest();
        http.open('HEAD', image_url, false);
        http.send();
        return http.status !== 404;
    }

    let generateImage = (wish, pointer, id) => {
        let url = `img/${wish[pointer].code + imageSet}.`
        if (checkImageExist(url + "jpg")) {
            document.getElementById(id).src = url + "jpg"
        } else {
            document.getElementById(id).src = url + "png"
        }
    }

    let generateImages = (wish) => {
        console.log(wish, pointer, imageSet)
        generateImage(wish, pointer, "img1")
        generateImage(wish, pointer + 1, "img2")
    }

    let storeDecision = (wish, storeWish) => {
        if (decision === "first") {
            storeWish.push(wish[pointer])
        }
        if (decision === "second") {
            storeWish.push(wish[pointer + 1])
        }
    }

    let storeCustomDecision = (wish, storeWish, customPointer) => {
        storeWish.push(wish[customPointer])
    }

    let startSets = () => {
        if (decision !== null) {
            storeDecision(wishes, storedWishes)
            pointer = pointer + 2
        }

        if (wishes.length-2 === -1) {
            finalResult = wishes[0].description
            document.getElementById("result").innerHTML=`${finalResult}`
            return
        }

        if (pointer > wishes.length - 2) {
            if (wishes.length % 2 !== 0) {
                storeCustomDecision(wishes, storedWishes, wishes.length - 1)
            }
            imageSet = imageSet + 1
            pointer = 0
            decision = null
            wishes = storedWishes
            storedWishes = []
            startSets()
        } else {
            generateImages(wishes)
        }

    }

    let selectWish = (pickedDecision) => {
        decision = pickedDecision
        startSets()
    }


</script>

</body>
</html>